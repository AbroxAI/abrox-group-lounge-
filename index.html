<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox â€“ Private Lounge</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#1c1f26">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="emoji-pack.js" defer></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg:'#1c1f26',
        panel:'#232833',
        border:'#343a4a',
        muted:'#a0a6b5',
        accent:'#2ecc71',
        bubble:'#262b38',
        send:'#3b82f6'
      }
    }
  }
}
</script>

<style>
/* ===== CHAT LAYOUT ===== */
.msg{display:flex;gap:8px}
.msg.out{justify-content:flex-end}

/* ===== IMPROVED CHAT BUBBLES ===== */
.bubble{
  padding:10px 14px;
  font-size:13px;
  line-height:1.45;
  max-width:78%;
  border-radius:16px;
  position:relative;
  box-shadow:0 2px 8px rgba(0,0,0,.18);
}

/* incoming */
.msg.in .bubble{
  background:#262b38;
  border-top-left-radius:6px;
}

/* outgoing */
.msg.out .bubble{
  background:linear-gradient(135deg,#3b82f6,#2563eb);
  color:#fff;
  border-top-right-radius:6px;
}

/* tails */
.msg.in .bubble::before{
  content:'';
  position:absolute;
  left:-6px;
  bottom:8px;
  width:12px;
  height:12px;
  background:#262b38;
  border-bottom-right-radius:12px;
}

.msg.out .bubble::before{
  content:'';
  position:absolute;
  right:-6px;
  bottom:8px;
  width:12px;
  height:12px;
  background:#2563eb;
  border-bottom-left-radius:12px;
}

/* grouped messages */
.grouped.in .bubble::before,
.grouped.out .bubble::before{display:none}

.grouped.in .bubble{border-top-left-radius:6px}
.grouped.out .bubble{border-top-right-radius:6px}

/* meta */
.sender{font-size:11px;font-weight:600;color:#2ecc71;margin-bottom:4px}
.time{
  font-size:10px;
  opacity:.75;
  margin-top:6px;
  display:flex;
  justify-content:flex-end;
  gap:4px;
}

.date-sep{text-align:center;font-size:11px;color:#a0a6b5;margin:12px 0}
.typing{font-size:11px;color:#a0a6b5;padding:6px}

/* per-user read avatars */
.read-by{
 display:flex;
 gap:4px;
 margin-top:4px;
 justify-content:flex-end;
}
.read-by img{
 width:13px;
 height:13px;
 border-radius:999px;
 border:1px solid #1c1f26;
}

/* badges */
.badge{font-size:10px;padding:2px 6px;border-radius:999px}
.badge.admin{background:#e74c3c}
.badge.mod{background:#f39c12}
.badge.verified{background:#2ecc71}
</style>
</head>

<body class="bg-bg text-white h-[100dvh] overflow-hidden">

<div class="flex h-full">

<main class="flex flex-col flex-1 border-r border-border">

<header class="bg-panel border-b border-border px-4 py-3 flex items-center justify-between">
  <div class="flex gap-3 items-center">
    <img src="assets/logo.png" class="w-8 h-8">
    <div>
      <div class="text-sm font-semibold">Abrox Binary Bot â€“ Private Lounge</div>
      <div class="flex items-center gap-1 text-xs text-muted">
        <i data-lucide="lock" class="w-3 h-3"></i>
        <span>Private Group</span>
      </div>
      <div class="text-xs text-muted">
        Members: 4,872 â€¢ Online: <span id="onlineCount">132</span><br>
        Demo discussion Â· Verification required
      </div>
    </div>
  </div>
  <button id="membersBtn"><i data-lucide="users"></i></button>
</header>

<section id="chat" class="flex-1 overflow-y-auto px-4 py-4 space-y-2 scroll-smooth">
  <div class="text-center text-muted text-sm">
    ðŸ“Œ <strong>Group Rules</strong><br>
    New members are read-only until verified<br>
    Admins DM individually<br>
    No screenshots in chat<br>
    Ignore unsolicited messages
  </div>
</section>

<div id="typing" class="typing hidden">Someone is typingâ€¦</div>

<footer class="bg-panel border-t border-border px-4 py-3">
  <div class="flex gap-2 items-center bg-bg rounded-full px-3 py-2">
    <button onclick="EmojiPack.openPicker(input)"><i data-lucide="smile"></i></button>
    <input id="input" class="flex-1 bg-transparent outline-none text-sm" placeholder="Message">
    <button id="attach" onclick="file.click()"><i data-lucide="paperclip"></i></button>
    <input id="file" type="file" hidden>
    <button id="mic"><i data-lucide="mic"></i></button>
    <button id="send" class="hidden"><i data-lucide="send"></i></button>
  </div>
</footer>

</main>

<!-- SIDEBAR -->
<aside id="sidebar" class="fixed right-0 top-0 w-72 h-full bg-panel border-l border-border translate-x-full transition-transform z-50 flex flex-col">
  <div class="p-4 border-b border-border flex items-center justify-between">
    <strong>Members</strong>
    <button id="closeSidebar"><i data-lucide="x"></i></button>
  </div>

  <div class="px-4 pb-2">
    <input id="search" class="w-full bg-bg px-2 py-1 text-sm rounded" placeholder="Search members">
  </div>

  <div id="memberList" class="flex-1 p-3 space-y-4 overflow-y-auto"></div>
</aside>

</div>

<script>
lucide.createIcons();

/* ===== ONLINE COUNT ===== */
let online=132;
setInterval(()=>{online+=Math.random()>.5?1:-1;onlineCount.textContent=online},8000);

/* ===== PRESENCE ===== */
const ACTIVE_WINDOW=90000;
const members=[
 {name:'Sam_Admin',role:'ADMIN',avatar:'https://randomuser.me/api/portraits/men/32.jpg',lastActive:Date.now()},
 {name:'Sara_Mod',role:'MOD',avatar:'https://randomuser.me/api/portraits/women/44.jpg',lastActive:Date.now()},
 {name:'Mina_fx',role:'VERIFIED',avatar:'https://randomuser.me/api/portraits/women/68.jpg',lastActive:Date.now()-120000}
];

const isOnline=m=>Date.now()-m.lastActive<ACTIVE_WINDOW;

setInterval(()=>{
 members[Math.floor(Math.random()*members.length)].lastActive=Date.now();
 renderMembers();
},20000);

/* ===== SIDEBAR ===== */
membersBtn.onclick=()=>sidebar.classList.toggle('translate-x-full');
closeSidebar.onclick=()=>sidebar.classList.add('translate-x-full');

let sx=0;
sidebar.addEventListener('touchstart',e=>sx=e.touches[0].clientX);
sidebar.addEventListener('touchend',e=>{
 if(e.changedTouches[0].clientX-sx>80)sidebar.classList.add('translate-x-full');
});

/* ===== MEMBERS LIST ===== */
function renderMembers(){
 memberList.innerHTML='';
 const q=search.value.toLowerCase();
 members.filter(m=>m.name.toLowerCase().includes(q))
 .sort((a,b)=>isOnline(b)-isOnline(a))
 .forEach(m=>{
  memberList.innerHTML+=`
  <div class="flex items-center gap-3">
    <div class="relative">
      <img src="${m.avatar}" class="w-9 h-9 rounded-full">
      <span class="absolute bottom-0 right-0 w-3 h-3 rounded-full ${isOnline(m)?'bg-green-500':'bg-gray-500'}"></span>
    </div>
    <div>
      <div class="text-sm">${m.name}</div>
      <span class="badge ${m.role.toLowerCase()}">${m.role}</span>
    </div>
  </div>`;
 });
}
search.oninput=renderMembers;
setInterval(renderMembers,5000);
renderMembers();

/* ===== CHAT ===== */
const chat=document.getElementById('chat');
const input=document.getElementById('input');
const send=document.getElementById('send');
const mic=document.getElementById('mic');
const attach=document.getElementById('attach');
const typing=document.getElementById('typing');
const file=document.getElementById('file');

let lastMeta=null,lastDate='';

function addDate(d){chat.innerHTML+=`<div class="date-sep">${d}</div>`}

function append(text,sender,out=false){
 const now=new Date();
 if(now.toDateString()!==lastDate){addDate(now.toDateString());lastDate=now.toDateString()}

 const grouped=lastMeta&&lastMeta.sender===sender&&lastMeta.out===out&&(now-lastMeta.time)<120000;
 const role=members.find(m=>m.name===sender)?.role;
 const badge=role?`<span class="badge ${role.toLowerCase()}">${role}</span>`:'';

 const el=document.createElement('div');
 el.className=`msg ${out?'out':'in'} ${grouped?'grouped':''}`;
 el.innerHTML=`
 <div class="bubble">
  ${!grouped&&!out?`<div class="sender">${sender} ${badge}</div>`:''}
  ${text}
  <div class="time">âœ“ ${now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
  <div class="read-by"></div>
 </div>`;
 chat.appendChild(el);

 if(out){
  const t=el.querySelector('.time');
  const r=el.querySelector('.read-by');
  setTimeout(()=>t.textContent=`âœ“âœ“ ${t.textContent.slice(2)}`,600);
  setTimeout(()=>{
    t.textContent=`âœ“âœ“ ðŸ‘€ ${t.textContent.slice(2)}`;
    members.filter(isOnline).slice(0,3)
      .forEach(m=>r.innerHTML+=`<img src="${m.avatar}" title="${m.name}">`);
  },1400);
 }

 lastMeta={sender,out,time:now};
 chat.scrollTo({top:chat.scrollHeight,behavior:'smooth'});
}

/* ===== INPUT ===== */
input.oninput=()=>{
 const has=input.value.trim();
 send.classList.toggle('hidden',!has);
 mic.classList.toggle('hidden',has);
 attach.classList.toggle('hidden',has);
 typing.classList.remove('hidden');
 clearTimeout(window.tt);
 window.tt=setTimeout(()=>typing.classList.add('hidden'),1200);
};

send.onclick=()=>{
 if(!input.value.trim())return;
 append(input.value,'You',true);
 input.value='';
 send.classList.add('hidden');
 mic.classList.remove('hidden');
 attach.classList.remove('hidden');
};

file.onchange=e=>{
 const r=new FileReader();
 r.onload=()=>append(`<img src="${r.result}" class="rounded-lg max-w-full">`,'You',true);
 r.readAsDataURL(e.target.files[0]);
};
</script>

</body>
</html>
