<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox â€“ Private Lounge</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#1c1f26">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="emoji-pack.js" defer></script>

<style>
/* ========== HEADER (LOCKED â€” DO NOT TOUCH) ========== */
.header{background:#232833;border-bottom:1px solid #343a4a}
.typing-row{
  display:flex;align-items:center;gap:6px;
  padding:0 16px;height:0;overflow:hidden;
  font-size:12px;font-weight:500;color:#6bdba7;
  opacity:0;transition:height .18s ease,opacity .12s ease
}
.typing-row.active{height:22px;opacity:1}

/* ========== CHAT CORE ========== */
.chat{flex:1;overflow-y:auto;padding:16px}
.msg{display:flex;gap:6px;margin-bottom:8px}
.msg.out{justify-content:flex-end}
.grouped{margin-top:-6px}

.avatar{width:32px;height:32px;border-radius:999px;flex:none}

.bubble{
  max-width:78%;padding:8px 14px 7px;
  font-size:13px;line-height:1.45;
  position:relative;
  box-shadow:0 2px 8px rgba(0,0,0,.18)
}
.msg.in .bubble{background:#262b38;border-radius:6px 18px 18px 6px}
.msg.out .bubble{background:#2b3242;border-radius:18px 6px 6px 18px}

/* tails */
.msg.in .bubble::before{
  content:'';position:absolute;left:-6px;top:14px;
  width:8px;height:8px;background:#262b38;
  border-radius:0 0 0 8px
}
.msg.out .bubble::after{
  content:'';position:absolute;right:-6px;top:14px;
  width:8px;height:8px;background:#2b3242;
  border-radius:0 0 8px 0
}
.grouped .bubble::before,.grouped .bubble::after{display:none}

/* sender */
.sender{font-size:12px;font-weight:600;color:#6bdba7;margin-bottom:4px;display:flex;gap:6px}

/* reply */
.reply-preview{
  display:flex;gap:6px;
  margin:-2px 0 6px;padding-left:6px;
  border-left:2px solid #6bdba7;
  font-size:11px;color:#a0a6b5;cursor:pointer
}
.reply-preview .sender{font-size:11px;margin:0}

/* reactions */
.reactions{display:flex;gap:6px;margin-top:6px}
.reaction{font-size:11px;padding:2px 8px;border-radius:999px;
  background:#1c1f26;border:1px solid #343a4a}

/* footer */
.footer{background:#232833;border-top:1px solid #343a4a;padding:12px}
</style>
</head>

<body class="bg-[#1c1f26] text-white h-[100dvh] flex flex-col">

<!-- ===== HEADER (PHASE-1 LOCKED) ===== -->
<header class="header">
  <div class="flex items-center justify-between px-4 py-3">
    <div class="flex gap-3 items-center">
      <div class="w-8 h-8 rounded bg-[#6bdba7]"></div>
      <div>
        <div class="text-sm font-semibold">Abrox Binary Bot â€“ Private Lounge</div>
        <div class="flex items-center gap-1 text-xs text-gray-400">
          <i data-lucide="lock" class="w-3 h-3"></i><span>Private Group</span>
        </div>
      </div>
    </div>
    <i data-lucide="users"></i>
  </div>
  <div class="px-4 text-xs text-gray-400">Members: 4,872 â€¢ Online: <span id="online">132</span></div>
  <div class="px-4 text-xs text-gray-500 pb-1">Demo discussion Â· Verification required</div>
  <div id="typingRow" class="typing-row">
    <span class="w-2 h-2 rounded-full bg-[#6bdba7]"></span>
    <span id="typingText"></span>
  </div>
</header>

<!-- ===== CHAT ===== -->
<div id="chat" class="chat"></div>

<!-- ===== INPUT ===== -->
<div class="footer flex items-center gap-2">
  <button id="emojiBtn"><i data-lucide="smile"></i></button>
  <input id="input" class="flex-1 bg-transparent outline-none text-sm" placeholder="Message">
  <button id="send"><i data-lucide="send"></i></button>
</div>

<script>
lucide.createIcons();

/* ===== DATA ===== */
const chat=document.getElementById('chat');
const input=document.getElementById('input');
const send=document.getElementById('send');
const typingRow=document.getElementById('typingRow');
const typingText=document.getElementById('typingText');

const reactions=new Map();
let replyTo=null;

/* ===== TYPING ===== */
let t;
input.oninput=()=>{
  typingText.textContent='You are typingâ€¦';
  typingRow.classList.add('active');
  clearTimeout(t);
  t=setTimeout(()=>typingRow.classList.remove('active'),1600);
};

/* ===== SEND ===== */
send.onclick=()=>{
  if(!input.value.trim())return;
  post({name:'You',out:true,text:input.value,reply:replyTo});
  replyTo=null;input.value='';
};

/* ===== POST ===== */
function post(m){
  m.id=crypto.randomUUID();
  render(m);
}

/* ===== RENDER ===== */
function render(m){
  const el=document.createElement('div');
  el.className='msg '+(m.out?'out':'in');
  el.dataset.id=m.id;

  el.innerHTML=`
    ${!m.out?'<img class="avatar" src="https://randomuser.me/api/portraits/men/32.jpg">':''}
    <div class="bubble">
      ${m.reply?`
        <div class="reply-preview" onclick="jump('${m.reply.id}')">
          <div>
            <div class="sender">${m.reply.name}</div>
            <div>${m.reply.text}</div>
          </div>
        </div>`:''}
      ${!m.out?'<div class="sender">'+m.name+'</div>':''}
      <div>${m.text}</div>
      <div class="reactions"></div>
    </div>`;
  chat.appendChild(el);
  chat.scrollTop=chat.scrollHeight;
}

/* ===== REACTIONS ===== */
chat.addEventListener('contextmenu',e=>{
  e.preventDefault();
  const msg=e.target.closest('.msg');
  if(!msg)return;
  openPicker(msg);
});

function openPicker(msg){
  const p=document.createElement('div');
  p.className='fixed bg-[#232833] border border-[#343a4a] rounded-xl p-2 flex gap-2 z-50';
  ['ðŸ‘','ðŸ˜‚','ðŸ”¥','â¤ï¸'].forEach(r=>{
    const b=document.createElement('button');
    b.textContent=r;
    b.onclick=()=>{addReaction(msg.dataset.id,r);p.remove();}
    p.appendChild(b);
  });
  document.body.appendChild(p);
  const r=msg.getBoundingClientRect();
  p.style.left=r.left+'px';p.style.top=(r.top-42)+'px';
}

function addReaction(id,r){
  if(!reactions.has(id))reactions.set(id,new Map());
  const m=reactions.get(id);
  m.set(r,(m.get(r)||0)+1);
  const el=document.querySelector(`[data-id="${id}"] .reactions`);
  el.innerHTML='';
  m.forEach((v,k)=>el.innerHTML+=`<span class="reaction">${k} ${v}</span>`);
}

/* ===== REPLY ===== */
function jump(id){
  document.querySelector(`[data-id="${id}"]`)?.scrollIntoView({behavior:'smooth'});
}

/* ===== DEMO ===== */
post({name:'Admin',text:'Welcome everyone ðŸ‘‹'});
</script>

</body>
</html>
