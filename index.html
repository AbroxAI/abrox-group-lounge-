<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox â€“ Private Lounge</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg:'#1c1f26',
        panel:'#232833',
        border:'#343a4a',
        muted:'#a0a6b5',
        accent:'#2ecc71',
        admin:'#f1c40f',
        bubble:'#262b38',
        system:'#3b4151'
      }
    }
  }
}
</script>

<script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-bg text-white h-screen overflow-hidden">

<div class="flex h-full">

<main class="flex flex-col flex-1 border-r border-border">

<header class="bg-panel border-b border-border px-4 py-3">
  <div class="flex gap-4 items-start">
    <i data-lucide="arrow-left" class="w-5 h-5 text-muted mt-1"></i>

    <img src="assets/logo.png" class="w-10 h-10 object-contain"/>

    <div class="leading-tight space-y-1">
      <div class="text-sm font-semibold">Abrox Binary Bot â€“ Private Lounge</div>
      <div class="flex items-center gap-1 text-xs text-muted">
        <i data-lucide="lock" class="w-3.5 h-3.5"></i>
        <span>Private Group</span>
      </div>
      <div class="text-xs text-muted">
        Members: 4,872 â€¢ Online: <span id="onlineCount">132</span>
      </div>
      <div class="text-[11px] text-muted/80">
        Demo discussion Â· Verification required
      </div>
    </div>
  </div>
</header>

<section id="chatMessages" class="flex-1 px-4 overflow-y-auto space-y-4 pb-6"></section>

<footer class="bg-panel border-t border-border px-4 py-3">
  <div class="flex items-center gap-3 bg-bg rounded-xl px-4 py-2 opacity-60" id="inputWrapper">
    <input id="chatInput"
      class="flex-1 bg-transparent outline-none text-sm placeholder-muted"
      placeholder="You must be verified to chat"
      disabled
    />
    <button id="micBtn"><i data-lucide="mic" class="w-5 h-5 text-muted"></i></button>
    <button id="sendBtn" class="hidden"><i data-lucide="send" class="w-5 h-5 text-accent"></i></button>
  </div>
</footer>

</main>
</div>

<script>
lucide.createIcons();

/* ===== STATE ===== */
const isVerified = false;
const chat = document.getElementById('chatMessages');
const input = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');
const wrapper = document.getElementById('inputWrapper');

let lastSend = 0;

/* ===== HELPERS ===== */
function escapeHTML(str) {
  return str.replace(/[&<>"']/g, m =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
  );
}

function isNearBottom() {
  return chat.scrollHeight - chat.scrollTop - chat.clientHeight < 120;
}

function renderMessage({ role, text, time }) {
  const atBottom = isNearBottom();
  const div = document.createElement('div');

  if (role === 'system') {
    div.className = 'text-center text-xs text-muted';
    div.textContent = text;
  }

  if (role === 'user') {
    div.className = 'flex justify-end';
    div.innerHTML = `
      <div class="max-w-[70%] bg-accent/20 px-3 py-2 rounded-[14px_14px_4px_14px] text-sm">
        <p>${escapeHTML(text)}</p>
        <span class="block text-[10px] text-muted mt-1 text-right">${time}</span>
      </div>
    `;
  }

  if (role === 'admin') {
    div.className = 'flex justify-start';
    div.innerHTML = `
      <div class="max-w-[70%] bg-bubble px-3 py-2 rounded-[14px_14px_14px_4px] text-sm">
        <p>${escapeHTML(text)}</p>
        <span class="block text-[10px] text-muted mt-1">${time}</span>
      </div>
    `;
  }

  chat.appendChild(div);
  if (atBottom) chat.scrollTop = chat.scrollHeight;
}

/* ===== VERIFICATION LOCK ===== */
if (!isVerified) {
  renderMessage({
    role: 'system',
    text: 'ðŸ”’ You are read-only until an admin verifies your account.',
    time: ''
  });
}

/* ===== SEND LOGIC ===== */
function updateSendState() {
  const hasText = input.value.trim().length > 0;
  micBtn.classList.toggle('hidden', hasText);
  sendBtn.classList.toggle('hidden', !hasText);
}

function sendMessage() {
  if (!isVerified) return;

  const now = Date.now();
  if (now - lastSend < 300) return;

  const text = input.value.trim();
  if (!text) return;

  lastSend = now;

  renderMessage({
    role: 'user',
    text,
    time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
  });

  input.value = '';
  updateSendState();
}

input.addEventListener('input', updateSendState);
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
});
sendBtn.addEventListener('click', sendMessage);
</script>

</body>
</html>
