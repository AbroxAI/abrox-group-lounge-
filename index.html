<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox ‚Äì Private Lounge</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#1c1f26">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="emoji-pack.js" defer></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg:'#1c1f26',
        panel:'#232833',
        border:'#343a4a',
        muted:'#a0a6b5',
        accent:'#6bdba7',
        bubble:'#262b38',
        bubbleOut:'#2b3242',
        send:'#3b82f6'
      }
    }
  }
}
</script>

<style>
*{box-sizing:border-box}

/* ================= HEADER ================= */
.header{background:#232833;border-bottom:1px solid #343a4a}

/* members / typing rows */
.members-row,.typing-row{
  padding:0 16px;height:22px;font-size:12px;
  display:flex;align-items:center
}
.members-row{color:#a0a6b5}
.typing-row{gap:8px;font-weight:500;color:#6bdba7;display:none}
.typing-row.active{display:flex}
.members-row.hidden{display:none}

/* typing dots */
.typing-dots{display:flex;gap:3px}
.typing-dots span{
  width:4px;height:4px;border-radius:999px;
  background:#6bdba7;opacity:.25;
  animation:blink 1.4s infinite both
}
.typing-dots span:nth-child(2){animation-delay:.15s}
.typing-dots span:nth-child(3){animation-delay:.3s}
@keyframes blink{0%,80%,100%{opacity:.25}40%{opacity:1}}

/* ================= CHAT ================= */
.msg{display:flex;gap:8px;margin-bottom:8px;align-items:flex-end}
.msg.out{justify-content:flex-end}
.grouped{margin-top:-6px}

.avatar{width:36px;height:36px;border-radius:999px}
.msg.grouped .avatar{visibility:hidden}

.bubble{
  max-width:74%;
  padding:8px 14px;
  font-size:14px;
  line-height:1.45;
  position:relative;
  box-shadow:0 2px 8px rgba(0,0,0,.18)
}
.msg.in .bubble{
  background:#262b38;
  border-radius:8px 18px 18px 8px
}
.msg.in .bubble::before{
  content:'';
  position:absolute;
  left:-6px;bottom:14px;
  width:10px;height:10px;
  background:#262b38;
  transform:rotate(45deg)
}
.msg.out .bubble{
  background:#2b3242;
  border:1px solid #343a4a;
  border-radius:18px 8px 8px 18px
}
.msg.out .bubble::after{
  content:'';
  position:absolute;
  right:-6px;bottom:14px;
  width:10px;height:10px;
  background:#2b3242;
  transform:rotate(45deg)
}
.grouped.in .bubble::before,
.grouped.out .bubble::after{display:none}

/* meta */
.sender{
  font-size:12px;font-weight:600;color:#6bdba7;
  margin-bottom:4px;display:flex;gap:6px;align-items:center
}
.time{
  font-size:10px;opacity:.65;margin-top:6px;
  display:flex;gap:6px;justify-content:flex-end;align-items:center
}
.read-by{
  font-size:11px;
  opacity:.75;
  margin-top:4px;
  display:flex;
  justify-content:flex-end;
  gap:4px;
}

/* badges */
.verified-bubble{
  display:inline-flex;align-items:center;gap:3px;
  padding:1px 4px;border-radius:999px;
  background:linear-gradient(180deg,#1b6d46,#125034);
  font-size:9px
}
.role-pill{font-size:9px;padding:1px 6px;border-radius:999px}
.role-pill.admin{background:#7f1d1d}
.role-pill.mod{background:#5b21b6}

/* reply */
.reply-preview{
  font-size:11px;opacity:.7;
  border-left:2px solid #6bdba7;
  padding-left:6px;margin-bottom:4px;
  cursor:pointer
}

/* reactions */
.reactions{display:flex;gap:4px;margin-top:4px}
.reaction{
  background:#1c1f26;border:1px solid #343a4a;
  border-radius:999px;padding:1px 6px;
  font-size:11px;cursor:pointer
}

/* pinned */
.pinned-banner{
  background:#232833;border-bottom:1px solid #343a4a;
  padding:6px 16px;font-size:13px;
  display:flex;gap:8px;align-items:center;cursor:pointer
}
.pinned-banner.hidden{display:none}

/* unread */
#unreadBtn{
  position:fixed;bottom:90px;left:50%;
  transform:translateX(-50%);
  background:#3b82f6;
  color:#fff;
  padding:6px 14px;
  border-radius:999px;
  font-size:12px;
  display:none;
  z-index:40
}

/* sidebar */
#sidebar{transition:transform .25s ease}

/* sidebar search */
#memberSearch{
  width:100%;
  padding:6px 10px;
  border-radius:999px;
  background:#1c1f26;
  border:1px solid #343a4a;
  font-size:12px;
  outline:none;
}

section{-webkit-overflow-scrolling:touch}
</style>
</head>

<body class="bg-bg text-white h-[100dvh] overflow-hidden">
<div class="flex h-full">

<main class="flex flex-col flex-1 border-r border-border">

<header class="header">
  <div class="flex items-center justify-between px-4 py-3">
    <div class="flex gap-3 items-center">
      <img src="assets/logo.png" class="w-9 h-9 rounded">
      <div>
        <div class="text-sm font-semibold">Abrox Binary Bot ‚Äì Private Lounge</div>
        <div class="flex items-center gap-1 text-xs text-muted">
          <i data-lucide="lock" class="w-3 h-3"></i>
          <span>Private Group</span>
        </div>
      </div>
    </div>
    <button id="membersBtn"><i data-lucide="users"></i></button>
  </div>

  <div class="members-row" id="membersRow">
    Members: <strong>4,872</strong>
    <span class="mx-2">‚Ä¢</span>
    Online: <strong id="onlineCount">0</strong>
  </div>

  <div class="typing-row" id="typingRow">
    <div class="typing-dots"><span></span><span></span><span></span></div>
    <span id="typingText"></span>
  </div>

  <div class="px-4 text-xs text-muted pb-1">
    Demo discussion ¬∑ Verification required
  </div>
</header>

<div id="pinnedBanner" class="pinned-banner hidden">
  <i data-lucide="pin"></i>
  <span id="pinnedText" class="flex-1 truncate"></span>
  <button id="unpinBtn"><i data-lucide="x"></i></button>
</div>

<section id="chat" class="flex-1 overflow-y-auto px-4 py-4">
  <div class="text-center text-muted text-sm mb-4">
    üìå <strong>Group Rules</strong><br>
    New members are read-only until verified<br>
    Admins DM individually<br>
    No screenshots in chat<br>
    Ignore unsolicited messages
  </div>
</section>

<button id="unreadBtn">‚¨á New messages</button>

<footer class="bg-panel border-t border-border px-4 py-3">
  <div class="flex items-center bg-bg rounded-full px-3 py-2 gap-2">
    <button id="emojiBtn"><i data-lucide="smile"></i></button>
    <input id="input" class="flex-1 bg-transparent outline-none text-sm" placeholder="Message">
    <div class="flex items-center gap-2 ml-auto">
      <button id="mediaBtn"><i data-lucide="paperclip"></i></button>
      <button id="micBtn"><i data-lucide="mic"></i></button>
      <button id="send" class="hidden text-send"><i data-lucide="send"></i></button>
    </div>
  </div>
</footer>

</main>

<aside id="sidebar" class="fixed right-0 top-0 w-72 h-full bg-panel border-l border-border translate-x-full z-50 flex flex-col">
  <div class="p-4 border-b border-border flex justify-between">
    <strong>Members</strong>
    <button id="closeSidebar"><i data-lucide="x"></i></button>
  </div>

  <div class="p-3">
    <input id="memberSearch" placeholder="Search members‚Ä¶">
  </div>

  <div id="memberList" class="flex-1 overflow-y-auto p-3 space-y-3"></div>
</aside>

<input type="file" id="fileInput" class="hidden">

<script>
/* ================= INIT ================= */
requestAnimationFrame(()=>lucide.createIcons());

/* ================= CORE ================= */
const chat=document.getElementById('chat');
const input=document.getElementById('input');
const send=document.getElementById('send');
const emojiBtn=document.getElementById('emojiBtn');
const mediaBtn=document.getElementById('mediaBtn');
const micBtn=document.getElementById('micBtn');
const fileInput=document.getElementById('fileInput');
const unreadBtn=document.getElementById('unreadBtn');

const membersRow=document.getElementById('membersRow');
const typingRow=document.getElementById('typingRow');
const typingText=document.getElementById('typingText');
const onlineCountEl=document.getElementById('onlineCount');

const sidebar=document.getElementById('sidebar');
const membersBtn=document.getElementById('membersBtn');
const closeSidebar=document.getElementById('closeSidebar');
const memberList=document.getElementById('memberList');
const memberSearch=document.getElementById('memberSearch');

/* ================= MEMBERS ================= */
const ADMIN={name:'Profit Hunter üåê',role:'ADMIN',avatar:'assets/admin.jpg'};
const MOD={name:'Kitty Star ‚≠ê',role:'MOD',avatar:'assets/mod.jpg'};
const members=[ADMIN,MOD,...Array.from({length:20},(_,i)=>({
  name:`Member_${i+1}`,
  role:'VERIFIED',
  avatar:`https://randomuser.me/api/portraits/men/${i+20}.jpg`,
  lastActive:Date.now()-Math.random()*300000
}))];

const ONLINE_LIMIT=90000;
const IDLE_LIMIT=300000;

function presence(m){
  const d=Date.now()-m.lastActive;
  if(d<ONLINE_LIMIT) return 'online';
  if(d<IDLE_LIMIT) return 'idle';
  return 'offline';
}

function renderMembers(){
  const q=memberSearch.value.toLowerCase();
  memberList.innerHTML='';
  members.filter(m=>m.name.toLowerCase().includes(q)).forEach(m=>{
    const p=presence(m);
    const color=p==='online'?'bg-green-500':p==='idle'?'bg-yellow-400':'bg-gray-500';
    memberList.innerHTML+=`
    <div class="flex gap-3 items-center">
      <div class="relative">
        <img src="${m.avatar}" class="w-9 h-9 rounded-full">
        <span class="absolute bottom-0 right-0 w-3 h-3 rounded-full ${color}"></span>
      </div>
      <div>
        <div class="text-sm">${m.name}</div>
        <span class="text-[10px] px-2 py-[1px] rounded-full ${
          m.role==='ADMIN'?'bg-red-600':
          m.role==='MOD'?'bg-purple-600':'bg-green-600'
        }">${m.role}</span>
      </div>
    </div>`;
  });
}

/* online simulation */
setInterval(()=>{
  members.forEach(m=>Math.random()>.6&&(m.lastActive=Date.now()));
  onlineCountEl.textContent=members.filter(m=>presence(m)==='online').length;
  renderMembers();
},4000);

memberSearch.oninput=renderMembers;

/* ================= TYPING ================= */
const typingMembers=members.map(m=>m.name).filter(n=>n!==ADMIN.name);
function showTyping(){
  const count=Math.floor(Math.random()*3)+1;
  const names=[...typingMembers].sort(()=>.5-Math.random()).slice(0,count);
  typingText.textContent=
    names.length===1?`${names[0]} is typing‚Ä¶`:
    names.length===2?`${names[0]} and ${names[1]} are typing‚Ä¶`:
    `${names.length} people are typing‚Ä¶`;
  typingRow.classList.add('active');
  membersRow.classList.add('hidden');
  setTimeout(()=>{
    typingRow.classList.remove('active');
    membersRow.classList.remove('hidden');
  },1500+Math.random()*1500);
}
setInterval(()=>Math.random()>.4&&showTyping(),5000);

/* ================= INPUT ================= */
input.oninput=()=>{
  const has=input.value.trim();
  send.classList.toggle('hidden',!has);
  mediaBtn.classList.toggle('hidden',!!has);
  micBtn.classList.toggle('hidden',!!has);
};

/* ================= SEND ================= */
let replyTo=null;
send.onclick=()=>{
  if(!input.value.trim())return;
  postMessage({name:'You',role:'VERIFIED',text:input.value,out:true,replyTo});
  replyTo=null;
  input.value='';
  send.classList.add('hidden');
  mediaBtn.classList.remove('hidden');
  micBtn.classList.remove('hidden');
};

/* ================= EMOJI ================= */
emojiBtn.onclick=()=>window.EmojiPack&&EmojiPack.openPicker(input);

/* ================= MEDIA ================= */
mediaBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  if(!e.target.files.length)return;
  const f=e.target.files[0];
  const url=URL.createObjectURL(f);
  const html=f.type.startsWith('image/')?
    `<img src="${url}" class="rounded-lg max-w-full">`:
    `üìé ${f.name}`;
  postMessage({name:'You',role:'VERIFIED',text:html,out:true});
  fileInput.value='';
};

/* ================= VOICE ================= */
let recorder,voiceChunks=[],recording=false;
micBtn.onmousedown=async()=>{
  if(recording)return;
  recording=true;
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  recorder=new MediaRecorder(stream);
  recorder.ondataavailable=e=>voiceChunks.push(e.data);
  recorder.onstop=()=>{
    const blob=new Blob(voiceChunks,{type:'audio/webm'});
    const url=URL.createObjectURL(blob);
    postMessage({name:'You',role:'VERIFIED',text:`<audio controls src="${url}"></audio>`,out:true});
    voiceChunks=[];
    stream.getTracks().forEach(t=>t.stop());
  };
  recorder.start();
};
micBtn.onmouseup=()=>{if(recording){recording=false;recorder.stop()}};

/* ================= PIN ================= */
let pinnedId=null;
const pinnedBanner=document.getElementById('pinnedBanner');
const pinnedText=document.getElementById('pinnedText');
document.getElementById('unpinBtn').onclick=e=>{
  e.stopPropagation();
  pinnedId=null;
  pinnedBanner.classList.add('hidden');
  localStorage.removeItem('pinnedId');
};
pinnedBanner.onclick=()=>{
  const el=document.querySelector(`[data-id="${pinnedId}"]`);
  el&&el.scrollIntoView({behavior:'smooth',block:'center'});
};

/* ================= MESSAGE ================= */
let lastMeta=null,lastDate='',unread=0;
const seenCache={};

function postMessage(m){
  m.id=crypto.randomUUID();
  m.time=Date.now();
  save(m);
  render(m,true);
}

function seenCount(){
  const online=members.filter(m=>presence(m)==='online').length;
  return Math.floor(online*(0.35+Math.random()*0.4));
}

function render(m,isNew=false){
  const d=new Date(m.time);
  if(d.toDateString()!==lastDate){
    const sep=document.createElement('div');
    sep.className='date-sep';
    sep.textContent=d.toDateString();
    chat.appendChild(sep);
    lastDate=d.toDateString();
  }

  const grouped=lastMeta&&lastMeta.sender===m.name&&(d-lastMeta.time)<120000;
  const badge =
    m.role==='ADMIN'?'<span class="role-pill admin">ADMIN</span>':
    m.role==='MOD'?'<span class="role-pill mod">MOD</span>':
    '<span class="verified-bubble"><i data-lucide="gem"></i></span>';

  if(m.out && !seenCache[m.id]) seenCache[m.id]=seenCount();

  const el=document.createElement('div');
  el.className=`msg ${m.out?'out':'in'} ${grouped?'grouped':''}`;
  el.dataset.id=m.id;
  el.innerHTML=`
    ${!m.out?`<img class="avatar" src="${members.find(x=>x.name===m.name)?.avatar||''}">`:''}
    <div class="bubble">
      ${m.replyTo?`<div class="reply-preview" data-jump="${m.replyTo}">‚Ü© Reply</div>`:''}
      ${!grouped&&!m.out?`<div class="sender">${m.name} ${badge}</div>`:''}
      <div class="content">${m.text}</div>
      <div class="reactions"></div>
      <div class="time">
        <i data-lucide="eye" class="w-3 h-3"></i>
        ${m.out?seenCache[m.id]:'¬∑'} ¬∑
        ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}
      </div>
    </div>`;
  chat.appendChild(el);
  lucide.createIcons();

  el.querySelectorAll('.reply-preview').forEach(r=>{
    r.onclick=()=>{
      const t=document.querySelector(`[data-id="${r.dataset.jump}"]`);
      t&&t.scrollIntoView({behavior:'smooth',block:'center'});
    };
  });

  el.querySelector('.bubble').ondblclick=()=>{
    const box=el.querySelector('.reactions');
    box.innerHTML=box.innerHTML?'' : `<div class="reaction">üëç 1</div>`;
  };

  el.oncontextmenu=e=>{
    e.preventDefault();
    const menu=document.createElement('div');
    menu.className='fixed bg-panel border border-border rounded-xl p-2 space-y-2 z-50';
    menu.innerHTML=`
      <button data-a="reply" class="flex gap-2"><i data-lucide="reply"></i>Reply</button>
      <button data-a="pin" class="flex gap-2"><i data-lucide="pin"></i>Pin</button>`;
    menu.onclick=ev=>{
      const a=ev.target.closest('button')?.dataset.a;
      if(a==='reply') replyTo=m.id;
      if(a==='pin'){
        pinnedId=m.id;
        pinnedText.textContent=el.querySelector('.content').textContent;
        pinnedBanner.classList.remove('hidden');
        localStorage.setItem('pinnedId',pinnedId);
      }
      menu.remove();
    };
    document.body.appendChild(menu);
    menu.style.left=e.pageX+'px';
    menu.style.top=e.pageY+'px';
    lucide.createIcons();
  };

  lastMeta={sender:m.name,time:d};

  if(isNew && chat.scrollTop+chat.clientHeight<chat.scrollHeight-40){
    unread++;
    unreadBtn.textContent=`‚¨á ${unread} new messages`;
    unreadBtn.style.display='block';
  }else{
    chat.scrollTop=chat.scrollHeight;
  }
}

/* ================= UNREAD ================= */
unreadBtn.onclick=()=>{
  chat.scrollTop=chat.scrollHeight;
  unread=0;
  unreadBtn.style.display='none';
};

/* ================= SIDEBAR ================= */
membersBtn.onclick=()=>sidebar.classList.toggle('translate-x-full');
closeSidebar.onclick=()=>sidebar.classList.add('translate-x-full');

/* ================= DB ================= */
const DB='AbroxDB',STORE='messages';
let db;
const req=indexedDB.open(DB,1);
req.onupgradeneeded=e=>{
  e.target.result.createObjectStore(STORE,{keyPath:'id'});
};
req.onsuccess=e=>{
  db=e.target.result;
  db.transaction(STORE).objectStore(STORE).getAll().onsuccess=ga=>{
    (ga.target.result||[]).sort((a,b)=>a.time-b.time).forEach(m=>render(m));
  };
};
function save(m){
  try{db.transaction(STORE,'readwrite').objectStore(STORE).put(m)}catch{}
}

/* ================= RESTORE PIN ================= */
const savedPin=localStorage.getItem('pinnedId');
if(savedPin){
  pinnedId=savedPin;
  pinnedBanner.classList.remove('hidden');
}

/* ================= JOIN MESSAGE ================= */
if(!localStorage.getItem('joined')){
  localStorage.setItem('joined','1');
  setTimeout(()=>{
    postMessage({name:'System',role:'ADMIN',text:'üëã You joined the group',out:false});
  },400);
}

/* ================= SAMPLE ================= */
setTimeout(()=>{
  postMessage({name:ADMIN.name,role:'ADMIN',text:'Welcome everyone üëã',out:false});
  postMessage({name:MOD.name,role:'MOD',text:'Please follow the rules.',out:false});
},600);
</script>

</body>
</html>
