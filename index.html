<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox â€“ Private Lounge</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#1c1f26">

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg:'#1c1f26',
        panel:'#232833',
        border:'#343a4a',
        muted:'#a0a6b5',
        accent:'#2ecc71',
        bubble:'#262b38',
        recording:'#e74c3c'
      }
    }
  }
}
</script>

<script src="https://unpkg.com/lucide@latest"></script>

<style>
.msg{display:flex;gap:8px;align-items:flex-end}
.msg.out{justify-content:flex-end}
.msg .bubble{background:#262b38;padding:10px 12px;font-size:13px;border-radius:14px 14px 14px 4px;max-width:78%}
.msg.out .bubble{border-radius:14px 14px 4px 14}
.time{font-size:10px;color:#a0a6b5;margin-top:4px;text-align:right}
.system{text-align:center;color:#a0a6b5;font-size:13px}
.typing{font-size:11px;color:#a0a6b5;padding-left:6px;transition:opacity .3s}
.transition-bg{transition:background-color .2s}
.bg-recording{background:#e74c3c!important}
.text-white-important{color:#fff!important}
.wave-bar{width:2px;background:#fff;border-radius:2px}
.transcript{font-size:11px;color:#a0a6b5;margin-top:4px}
#send i{transition:transform .2s}
#send.send-active i{transform:translateX(4px) rotate(20deg)}
#mic{touch-action:none}
</style>
</head>

<body class="bg-bg text-white h-[100dvh] overflow-hidden">

<div class="flex h-full">
<main class="flex flex-col flex-1 border-r border-border">

<header class="bg-panel border-b border-border px-4 py-3">
  <div class="flex justify-between">
    <div class="flex gap-4">
      <i data-lucide="arrow-left" class="w-5 h-5 text-muted mt-1"></i>
      <img src="assets/logo.png" class="w-10 h-10 object-contain"/>
      <div class="leading-tight">
        <div class="text-sm font-semibold">Abrox Binary Bot â€“ Private Lounge</div>
        <div class="text-xs text-muted flex items-center gap-1">
          <i data-lucide="lock" class="w-3.5 h-3.5"></i> Private Group
        </div>
        <div class="text-xs text-muted">
          Members: 4,872 â€¢ Online: <span id="onlineCount">132</span>
        </div>
        <div class="text-[11px] text-muted/80">Demo discussion Â· Verification required</div>
      </div>
    </div>
    <i data-lucide="users" class="w-5 h-5 text-muted"></i>
  </div>
</header>

<section id="chat" class="flex-1 overflow-y-auto px-4 py-4 space-y-4">
  <div class="system">
    ğŸ“Œ <strong>Group Rules</strong><br>
    New members are read-only until verified<br>
    Admins DM individually<br>
    No screenshots in chat<br>
    Ignore unsolicited messages
  </div>
</section>

<footer class="bg-panel border-t border-border px-4 py-3 pb-[env(safe-area-inset-bottom)]">
  <div class="flex items-center gap-3 bg-bg rounded-full px-4 py-2">

    <button id="emojiBtn"><i data-lucide="smile" class="w-5 h-5 text-muted"></i></button>
    <input id="input" class="flex-1 bg-transparent outline-none text-sm" placeholder="Message">

    <div class="relative w-10 h-10">
      <button id="mic" class="absolute inset-0 bg-white rounded-full flex items-center justify-center transition-bg overflow-hidden">
        <i data-lucide="mic" class="w-5 h-5 text-bg"></i>
        <div id="micWave" class="absolute flex bottom-1 left-1/2 -translate-x-1/2 h-6 gap-1 hidden">
          <span class="wave-bar"></span><span class="wave-bar"></span><span class="wave-bar"></span><span class="wave-bar"></span><span class="wave-bar"></span>
        </div>
      </button>
    </div>

  </div>

  <!-- FULL EMOJI PACK -->
  <div id="emojiPanel" class="hidden mt-2 bg-panel rounded-xl p-3 grid grid-cols-8 gap-2 text-lg max-h-40 overflow-y-auto">
ğŸ˜€ ğŸ˜ ğŸ˜‚ ğŸ¤£ ğŸ˜ƒ ğŸ˜„ ğŸ˜… ğŸ˜† ğŸ˜‰ ğŸ˜Š ğŸ˜ ğŸ˜˜ ğŸ˜œ ğŸ¤ª ğŸ¤¨ ğŸ˜ ğŸ˜­ ğŸ˜¡ ğŸ˜± ğŸ˜´ ğŸ¤¯ ğŸ¤— ğŸ¤” ğŸ‘ ğŸ‘ ğŸ™ ğŸ‘ ğŸ’ª ğŸ”¥ â¤ï¸ ğŸ’” ğŸ‰ ğŸ¯ ğŸš€ ğŸ’° ğŸ“ˆ ğŸ“‰
  </div>
</footer>

</main>
</div>

<script>
lucide.createIcons();

/* ONLINE */
const el=document.getElementById('onlineCount');
let online=132;
setInterval(()=>{online+=Math.random()>.5?1:-1;el.textContent=online},8000);

/* ELEMENTS */
const input=document.getElementById('input');
const chat=document.getElementById('chat');
const mic=document.getElementById('mic');
const micWave=document.getElementById('micWave');
const emojiBtn=document.getElementById('emojiBtn');
const emojiPanel=document.getElementById('emojiPanel');
const bars=[...micWave.children];

/* EMOJI PICKER (RESTORED) */
emojiBtn.onclick=()=>emojiPanel.classList.toggle('hidden');
emojiPanel.addEventListener('click',e=>{
  if(!e.target.textContent.trim()) return;
  input.value+=e.target.textContent;
  input.dispatchEvent(new Event('input'));
  emojiPanel.classList.add('hidden');
});

/* SPEECH TO TEXT */
const SpeechAPI=window.SpeechRecognition||window.webkitSpeechRecognition;
let speech=null, transcript='';
if(SpeechAPI){
  speech=new SpeechAPI();
  speech.continuous=true;
  speech.interimResults=true;
  speech.onresult=e=>{
    transcript=[...e.results].map(r=>r[0].transcript).join('');
  };
}

/* VOICE CORE */
let recorder=null,stream=null,chunks=[];
let audioCtx=null,analyser=null,data=null;
let recording=false,canceled=false,locked=false;
let holdTimer=null,raf=null;

const vibrate=ms=>navigator.vibrate&&navigator.vibrate(ms);

async function beginRecording(){
  if(recording) return;
  stream=await navigator.mediaDevices.getUserMedia({audio:true});
  const mime=MediaRecorder.isTypeSupported('audio/mp4')?'audio/mp4':'audio/webm';
  recorder=new MediaRecorder(stream,{mimeType:mime});
  chunks=[];
  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.start();

  speech&&speech.start();

  audioCtx=new AudioContext();
  analyser=audioCtx.createAnalyser();
  audioCtx.createMediaStreamSource(stream).connect(analyser);
  data=new Uint8Array(analyser.frequencyBinCount);

  recording=true;
  mic.classList.add('bg-recording');
  mic.querySelector('i').classList.add('text-white-important');
  micWave.classList.remove('hidden');
  animate();
}

function animate(){
  if(!recording) return;
  analyser.getByteFrequencyData(data);
  bars.forEach((b,i)=>b.style.height=(data[i]*0.05+4)+'px');
  raf=requestAnimationFrame(animate);
}

function move(e){
  if(!recording||locked) return;
  const p=e.touches?e.touches[0]:e;
  const r=mic.getBoundingClientRect();
  if(p.clientY<r.top-40) locked=true;
  if(p.clientX<r.left-40) canceled=true;
}

function stop(){
  clearTimeout(holdTimer);
  if(!recording) return;
  recording=false;

  speech&&speech.stop();
  cancelAnimationFrame(raf);

  mic.classList.remove('bg-recording');
  mic.querySelector('i').classList.remove('text-white-important');
  micWave.classList.add('hidden');

  recorder.stop();
  stream.getTracks().forEach(t=>t.stop());

  recorder.onstop=()=>{
    if(!canceled){
      const url=URL.createObjectURL(new Blob(chunks,{type:recorder.mimeType}));
      chat.innerHTML+=`
      <div class="msg out">
        <div class="bubble">
          <audio controls src="${url}" class="w-full"></audio>
          ${transcript?`<div class="transcript">${transcript}</div>`:''}
        </div>
      </div>`;
      chat.scrollTop=chat.scrollHeight;
    }
    transcript='';
    canceled=false;
    locked=false;
  };
}

/* POINTER EVENTS */
mic.addEventListener('pointerdown',e=>{
  e.preventDefault();
  vibrate(20);
  holdTimer=setTimeout(beginRecording,150);
});
mic.addEventListener('pointermove',move);
mic.addEventListener('pointerup',stop);
mic.addEventListener('pointercancel',()=>{canceled=true;stop()});
</script>

</body>
</html>
