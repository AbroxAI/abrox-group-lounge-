<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox â€“ Private Lounge</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#1c1f26">

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Abrox">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="emoji-pack.js" defer></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg:'#1c1f26',
        panel:'#232833',
        border:'#343a4a',
        muted:'#a0a6b5',
        accent:'#2ecc71',
        bubble:'#262b38',
        bubbleOut:'#2b3242',
        send:'#3b82f6'
      }
    }
  }
}
</script>

<style>
.msg{display:flex;gap:8px}
.msg.out{justify-content:flex-end}
.bubble{padding:10px 14px;font-size:13px;line-height:1.45;max-width:78%;border-radius:16px;position:relative;box-shadow:0 2px 8px rgba(0,0,0,.18)}
.msg.in .bubble{background:#262b38;border-top-left-radius:6px}
.msg.out .bubble{background:#2b3242;border:1px solid #343a4a;border-top-right-radius:6px}
.msg.in .bubble::before{content:'';position:absolute;left:-6px;bottom:8px;width:12px;height:12px;background:#262b38;border-bottom-right-radius:12px}
.msg.out .bubble::before{content:'';position:absolute;right:-6px;bottom:8px;width:12px;height:12px;background:#2b3242;border-bottom-left-radius:12px}
.grouped.in .bubble::before,.grouped.out .bubble::before{display:none}
.grouped.in .bubble{border-top-left-radius:6px}
.grouped.out .bubble{border-top-right-radius:6px}
.sender{font-size:11px;font-weight:600;color:#2ecc71;margin-bottom:4px}
.time{font-size:10px;opacity:.7;margin-top:6px;display:flex;justify-content:flex-end;gap:4px}
.read-by{display:flex;gap:4px;margin-top:4px;justify-content:flex-end}
.read-by img{width:13px;height:13px;border-radius:999px;border:1px solid #1c1f26}
.date-sep{text-align:center;font-size:11px;color:#a0a6b5;margin:12px 0}
.typing{font-size:11px;color:#a0a6b5;padding:6px}
.badge{font-size:10px;padding:2px 6px;border-radius:999px}
.badge.admin{background:#e74c3c}
.badge.mod{background:#f39c12}
.badge.verified{background:#2ecc71}

/* ===== VOICE RECORDING ===== */
.wave{display:flex;gap:3px;align-items:flex-end;height:18px}
.wave span{
  width:3px;background:#fff;border-radius:2px;
  animation:wave 1s infinite ease-in-out
}
.wave span:nth-child(2){animation-delay:.1s}
.wave span:nth-child(3){animation-delay:.2s}
.wave span:nth-child(4){animation-delay:.3s}

@keyframes wave{
  0%,100%{height:4px}
  50%{height:16px}
}

.recording{
  background:#e74c3c;
  border-radius:999px;
  padding:6px;
}
</style>
</head>

<body class="bg-bg text-white h-[100dvh] overflow-hidden">
<div class="flex h-full">

<main class="flex flex-col flex-1 border-r border-border">

<header class="bg-panel border-b border-border px-4 py-3 flex items-center justify-between">
  <div class="flex gap-3 items-center">
    <img src="assets/logo.png" class="w-8 h-8">
    <div>
      <div class="text-sm font-semibold">Abrox Binary Bot â€“ Private Lounge</div>
      <div class="flex items-center gap-1 text-xs text-muted">
        <i data-lucide="lock" class="w-3 h-3"></i>
        <span>Private Group</span>
      </div>
      <div class="text-xs text-muted">
        Members: 4,872 â€¢ Online: <span id="onlineCount">132</span><br>
        Demo discussion Â· Verification required
      </div>
    </div>
  </div>
  <button id="membersBtn"><i data-lucide="users"></i></button>
</header>

<section id="chat" class="flex-1 overflow-y-auto px-4 py-4 space-y-2 scroll-smooth">
  <div class="text-center text-muted text-sm">
    ðŸ“Œ <strong>Group Rules</strong><br>
    New members are read-only until verified<br>
    Admins DM individually<br>
    No screenshots in chat<br>
    Ignore unsolicited messages
  </div>
</section>

<div id="typing" class="typing hidden">Someone is typingâ€¦</div>

<footer class="bg-panel border-t border-border px-4 py-3">
  <div class="flex items-center bg-bg rounded-full px-3 py-2 gap-2">

<button id="emojiBtn"><i data-lucide="smile"></i></button>
<input id="input" class="flex-1 bg-transparent outline-none text-sm" placeholder="Message">

<div class="flex items-center gap-2 ml-auto">
  <button id="mediaBtn"><i data-lucide="paperclip"></i></button>
  <button id="micBtn"><i data-lucide="mic"></i></button>
  <button id="send" class="hidden text-send"><i data-lucide="send"></i></button>
</div>

  </div>
</footer>

</main>

<aside id="sidebar" class="fixed right-0 top-0 w-72 h-full bg-panel border-l border-border translate-x-full transition-transform z-50 flex flex-col">
  <div class="p-4 border-b border-border flex items-center justify-between">
    <strong>Members</strong>
    <button id="closeSidebar"><i data-lucide="x"></i></button>
  </div>
  <div id="memberList" class="flex-1 p-3 space-y-4 overflow-y-auto"></div>
</aside>

<input type="file" id="fileInput" class="hidden">

</div>

<script>
lucide.createIcons();

/* ================= FULL LOGIC ================= */

const chat=document.getElementById('chat');
const input=document.getElementById('input');
const send=document.getElementById('send');
const emojiBtn=document.getElementById('emojiBtn');
const mediaBtn=document.getElementById('mediaBtn');
const micBtn=document.getElementById('micBtn');
const fileInput=document.getElementById('fileInput');
const sidebar=document.getElementById('sidebar');
const membersBtn=document.getElementById('membersBtn');
const closeSidebar=document.getElementById('closeSidebar');
const memberList=document.getElementById('memberList');
const onlineCount=document.getElementById('onlineCount');

/* EMOJI */
emojiBtn.onclick=()=>EmojiPack.openPicker(input);

/* INPUT UI TOGGLE */
input.oninput=()=>{
  const hasText=input.value.trim().length>0;
  send.classList.toggle('hidden',!hasText);
  mediaBtn.classList.toggle('hidden',hasText);
  micBtn.classList.toggle('hidden',hasText);
};

/* MEDIA PICKER */
mediaBtn.onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  if(!e.target.files.length)return;
  const f=e.target.files[0];
  const m={name:'You',role:'VERIFIED',text:`ðŸ“Ž Media: ${f.name}`,timestamp:Date.now(),out:true};
  save(m); render(m);
  fileInput.value='';
};

/* MIC LONG-PRESS (SIMULATED) */
let pressTimer=null,recording=false;

function startPress(){
  pressTimer=setTimeout(()=>{
    recording=true;
    input.classList.add('hidden');
    micBtn.classList.add('recording');
    micBtn.innerHTML=`<div class="wave"><span></span><span></span><span></span><span></span></div>`;
  },300);
}

function endPress(){
  clearTimeout(pressTimer);
  if(!recording)return;
  recording=false;
  input.classList.remove('hidden');
  micBtn.classList.remove('recording');
  micBtn.innerHTML='<i data-lucide="mic"></i>';
  lucide.createIcons();
  const m={name:'You',role:'VERIFIED',text:'ðŸŽ¤ Voice message',timestamp:Date.now(),out:true};
  save(m); render(m);
}

['mousedown','touchstart'].forEach(e=>micBtn.addEventListener(e,startPress));
['mouseup','mouseleave','touchend','touchcancel'].forEach(e=>micBtn.addEventListener(e,endPress));

/* ===== EVERYTHING BELOW IS 100% YOUR ORIGINAL CODE ===== */

/* MEMBERS */
const ACTIVE=90000;
const ADMIN={name:'Profit Hunter ðŸŒ',role:'ADMIN',avatar:'assets/admin.jpg'};
const MOD={name:'Kitty Star â­',role:'MOD',avatar:'assets/mod.jpg'};
const members=[ADMIN,MOD,...Array.from({length:25},(_,i)=>({
  name:`Member_${i+1}`,
  role:'VERIFIED',
  avatar:`https://randomuser.me/api/portraits/men/${i+20}.jpg`,
  lastActive:Date.now()-Math.random()*120000
}))];

const isOnline=m=>Date.now()-m.lastActive<ACTIVE;

function renderMembers(){
  memberList.innerHTML='';
  members.forEach(m=>{
    memberList.innerHTML+=`
    <div class="flex gap-3 items-center">
      <div class="relative">
        <img src="${m.avatar}" class="w-9 h-9 rounded-full">
        <span class="absolute bottom-0 right-0 w-3 h-3 rounded-full ${isOnline(m)?'bg-green-500':'bg-gray-500'}"></span>
      </div>
      <div>
        <div class="text-sm">${m.name}</div>
        <span class="badge ${m.role.toLowerCase()}">${m.role}</span>
      </div>
    </div>`;
  });
  onlineCount.textContent=members.filter(isOnline).length;
}

setInterval(()=>{
  members[Math.floor(Math.random()*members.length)].lastActive=Date.now();
  renderMembers();
},8000);

renderMembers();
membersBtn.onclick=()=>sidebar.classList.toggle('translate-x-full');
closeSidebar.onclick=()=>sidebar.classList.add('translate-x-full');

/* DB + CHAT LOGIC */
const DB='AbroxDB',STORE='messages',PAGE=20;
let db,offset=0,loading=false,lastMeta=null,lastDate='';

indexedDB.open(DB,1).onupgradeneeded=e=>{
  e.target.result.createObjectStore(STORE,{keyPath:'id',autoIncrement:true});
};

indexedDB.open(DB,1).onsuccess=e=>{
  db=e.target.result; seed(); load();
};

function save(m){
  db.transaction(STORE,'readwrite').objectStore(STORE).add(m);
}

function seed(){
  const st=db.transaction(STORE).objectStore(STORE);
  st.count().onsuccess=e=>{
    if(e.target.result)return;
    [
      {...ADMIN,text:'Welcome to Abrox Private Lounge.',timestamp:Date.now()-86400000,out:false},
      {...MOD,text:'Please read pinned rules before chatting.',timestamp:Date.now()-86300000,out:false}
    ].forEach(save);
  };
}

function load(){
  if(loading)return;
  loading=true;
  db.transaction(STORE).objectStore(STORE).getAll().onsuccess=e=>{
    const all=e.target.result.sort((a,b)=>a.timestamp-b.timestamp);
    const slice=all.slice(Math.max(0,all.length-offset-PAGE),all.length-offset);
    slice.forEach(m=>render(m,true));
    offset+=PAGE;
    loading=false;
  };
}

function render(m,prepend=false){
  const d=new Date(m.timestamp);
  if(d.toDateString()!==lastDate){
    const sep=document.createElement('div');
    sep.className='date-sep';
    sep.textContent=d.toDateString();
    prepend?chat.prepend(sep):chat.appendChild(sep);
    lastDate=d.toDateString();
  }

  const grouped=lastMeta&&lastMeta.sender===m.name&&(d-lastMeta.time)<120000;
  const el=document.createElement('div');
  el.className=`msg ${m.out?'out':'in'} ${grouped?'grouped':''}`;
  el.innerHTML=`
    <div class="bubble">
      ${!grouped&&!m.out?`<div class="sender">${m.name} <span class="badge ${m.role.toLowerCase()}">${m.role}</span></div>`:''}
      ${m.text}
      <div class="time">âœ“ ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
      <div class="read-by"></div>
    </div>`;
  prepend?chat.prepend(el):chat.appendChild(el);
  if(m.out)receipts(el);
  lastMeta={sender:m.name,time:d};
}

function receipts(el){
  const t=el.querySelector('.time');
  const r=el.querySelector('.read-by');
  setTimeout(()=>t.textContent=`âœ“âœ“ ${t.textContent.slice(2)}`,600);
  setTimeout(()=>{
    t.textContent=`âœ“âœ“ ðŸ‘€ ${t.textContent.slice(2)}`;
    [ADMIN,MOD].forEach(u=>{
      const img=document.createElement('img');
      img.src=u.avatar;
      r.appendChild(img);
    });
  },1400);
}

send.onclick=()=>{
  if(!input.value.trim())return;
  const m={name:'You',role:'VERIFIED',text:input.value,timestamp:Date.now(),out:true};
  save(m); render(m);
  input.value='';
  send.classList.add('hidden');
  mediaBtn.classList.remove('hidden');
  micBtn.classList.remove('hidden');
};

chat.addEventListener('scroll',()=>{if(chat.scrollTop===0)load();});
</script>
</body>
</html>
