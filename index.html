<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Abrox â€“ Private Lounge</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        bg:'#1c1f26',
        panel:'#232833',
        border:'#343a4a',
        muted:'#a0a6b5',
        accent:'#2ecc71',
        admin:'#f1c40f',
        bubble:'#262b38',
        system:'#3b4151'
      }
    }
  }
}
</script>

<style>
  .caret-accent { caret-color: #2ecc71; }
</style>

<script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-bg text-white h-screen overflow-hidden">

<div class="flex h-full">
<main class="flex flex-col flex-1 border-r border-border">

<!-- HEADER -->
<header class="bg-panel border-b border-border px-4 py-3">
  <div class="flex gap-4 items-start">
    <i data-lucide="arrow-left" class="w-5 h-5 text-muted mt-1"></i>
    <img src="assets/logo.png" class="w-10 h-10 object-contain"/>
    <div class="leading-tight space-y-1">
      <div class="text-sm font-semibold">Abrox Binary Bot â€“ Private Lounge</div>
      <div class="flex items-center gap-1 text-xs text-muted">
        <i data-lucide="lock" class="w-3.5 h-3.5"></i>
        <span>Private Group</span>
      </div>
      <div class="text-xs text-muted">
        Members: 4,872 â€¢ Online: <span id="onlineCount">132</span>
      </div>
      <div class="text-[11px] text-muted/80">
        Demo discussion Â· Verification required
      </div>
    </div>
  </div>
</header>

<!-- CHAT -->
<section id="chatMessages" class="flex-1 px-4 overflow-y-auto space-y-4 pb-6"></section>

<!-- INPUT -->
<footer class="bg-panel border-t border-border px-4 py-3">
  <div class="flex items-center gap-3 bg-bg rounded-2xl px-4 py-2">

    <button class="text-muted"><i data-lucide="smile" class="w-5 h-5"></i></button>

    <input id="chatInput"
      class="flex-1 bg-transparent outline-none text-sm placeholder-muted caret-accent"
      placeholder="Message"
    />

    <button class="text-muted"><i data-lucide="paperclip" class="w-5 h-5"></i></button>
    <button class="text-muted"><i data-lucide="camera" class="w-5 h-5"></i></button>

    <button id="micBtn" class="text-muted">
      <i data-lucide="mic" class="w-5 h-5"></i>
    </button>

    <button id="sendBtn" class="text-accent hidden">
      <i data-lucide="send" class="w-5 h-5"></i>
    </button>

  </div>
</footer>

</main>
</div>

<script>
lucide.createIcons();

/* ===== STATE ===== */
const isVerified = false;
const chat = document.getElementById('chatMessages');
const input = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const micBtn = document.getElementById('micBtn');

let mediaRecorder;
let audioChunks = [];
let isRecording = false;

/* ===== HELPERS ===== */
function escapeHTML(str) {
  return str.replace(/[&<>"']/g, m =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
  );
}

function timeNow() {
  return new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });
}

function isNearBottom() {
  return chat.scrollHeight - chat.scrollTop - chat.clientHeight < 120;
}

/* ===== RENDERERS ===== */
function renderSystem(text) {
  const div = document.createElement('div');
  div.className = 'text-center text-xs text-muted';
  div.textContent = text;
  chat.appendChild(div);
}

function renderUserBubble(innerHTML) {
  const atBottom = isNearBottom();
  const wrap = document.createElement('div');
  wrap.className = 'flex justify-end';
  wrap.innerHTML = innerHTML;
  chat.appendChild(wrap);
  if (atBottom) chat.scrollTop = chat.scrollHeight;
}

/* ===== TEXT MESSAGE ===== */
function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  if (!isVerified) {
    renderSystem('ðŸ”’ You must complete verification to send messages.');
    input.value = '';
    updateSendState();
    return;
  }

  renderUserBubble(`
    <div class="max-w-[70%] bg-accent/20 px-3 py-2 rounded-[14px_14px_4px_14px] text-sm">
      <span>${escapeHTML(text)}</span>
      <span class="ml-2 text-[10px] text-muted float-right">${timeNow()}</span>
    </div>
  `);

  input.value = '';
  updateSendState();
}

/* ===== VOICE RECORDING (REAL) ===== */
async function startRecording(e) {
  e.preventDefault();
  if (isRecording) return;

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.onstop = sendVoice;

  mediaRecorder.start();
  isRecording = true;
  micBtn.classList.add('text-red-500');
}

function stopRecording() {
  if (!isRecording) return;
  mediaRecorder.stop();
  isRecording = false;
  micBtn.classList.remove('text-red-500');
}

function sendVoice() {
  if (!isVerified) {
    renderSystem('ðŸ”’ You must complete verification to send voice messages.');
    return;
  }

  const blob = new Blob(audioChunks, { type: 'audio/webm' });
  const url = URL.createObjectURL(blob);

  renderUserBubble(`
    <div class="max-w-[70%] bg-accent/20 px-3 py-2 rounded-[14px_14px_4px_14px] text-sm">
      <audio controls class="w-full h-8">
        <source src="${url}" type="audio/webm">
      </audio>
      <span class="ml-2 text-[10px] text-muted float-right">${timeNow()}</span>
    </div>
  `);
}

/* ===== INPUT STATE ===== */
function updateSendState() {
  const hasText = input.value.trim().length > 0;
  micBtn.classList.toggle('hidden', hasText);
  sendBtn.classList.toggle('hidden', !hasText);
}

/* ===== EVENTS ===== */
input.addEventListener('input', updateSendState);
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    sendMessage();
  }
});

sendBtn.addEventListener('click', sendMessage);

micBtn.addEventListener('mousedown', startRecording);
micBtn.addEventListener('mouseup', stopRecording);
micBtn.addEventListener('mouseleave', stopRecording);
micBtn.addEventListener('touchstart', startRecording);
micBtn.addEventListener('touchend', stopRecording);

/* ===== INIT ===== */
renderSystem('ðŸ”’ You are read-only until an admin verifies your account.');
updateSendState();
</script>

</body>
</html>
